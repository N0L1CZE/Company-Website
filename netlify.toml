[build]
  # runs CI install, generates Prisma client, runs migrations, seeds, builds
  command   = """
    npm ci &&
    npx prisma generate &&
    npx prisma migrate deploy &&
    npm run seed &&
    npm run build
  """
  publish   = ".next"

[functions]
  directory = ".netlify/functions-internal"
  [functions.environment]
    # pick up Neon’s pooled URL for runtime
    DATABASE_URL        = "$NETLIFY_DATABASE_URL"
    # pick up Neon’s direct unpooled URL for migrations/shadow
    SHADOW_DATABASE_URL = "$NETLIFY_DATABASE_URL_UNPOOLED"
    ADMIN_EMAIL         = "${ADMIN_EMAIL}"
    ADMIN_PASSWORD_HASH = "${ADMIN_PASSWORD_HASH}"
    JWT_SECRET          = "${JWT_SECRET}"
